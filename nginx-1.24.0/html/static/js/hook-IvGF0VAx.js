var C=(i,F,o)=>new Promise((b,c)=>{var x=n=>{try{p(o.next(n))}catch(m){c(m)}},d=n=>{try{p(o.throw(n))}catch(m){c(m)}},p=n=>n.done?b(n.value):Promise.resolve(n.value).then(x,d);p((o=o.apply(i,F)).next())});import{K as P,r as l,V as ce,a7 as de,aX as pe,o as me,dP as Y,i as s,b as $,dQ as fe,aV as ge,dJ as he,A as v,ah as ve,bl as be,aa as D,D as O,dR as xe,dS as ye,dT as Se,dU as Re,F as ke}from"./index-Zjjfkekr.js";import{_ as Ce}from"./role.vue_vue_type_script_setup_true_lang-1z8y5XuV.js";import{_ as De}from"./index.vue_vue_type_script_setup_true_lang-CRQjFwGj.js";import{z as Fe}from"./index.esm-BcMmGP1h.js";import{_ as Ie}from"./upload.vue_vue_type_script_setup_true_lang-BwXyhDpT.js";import{u as Te}from"./hooks-BVGQWvKu.js";import{g as Pe,c as $e,d as Oe,e as ze}from"./system-BlcEex_0.js";import"./index-BmD-sjfu.js";import"./index-BBxzDs5P.js";function Ae(i,F){const o=P({deptId:"",username:"",phone:"",status:""}),b=l(),c=l(),x=l([]),d=l(!0),p=l(),n=l({}),{switchStyle:m}=Te(),z=l(),M=l([]),I=l(!0),T=l(0),y=P({total:0,pageSize:10,currentPage:1,background:!0}),j=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"用户编号",prop:"id",width:90},{label:"用户头像",prop:"avatar",cellRenderer:({row:e})=>s($("el-image"),{fit:"cover","preview-teleported":!0,src:e.avatar,"preview-src-list":Array.of(e.avatar),class:"w-[24px] h-[24px] rounded-full align-middle"},null),width:90},{label:"用户名称",prop:"username",minWidth:130},{label:"用户昵称",prop:"nickname",minWidth:130},{label:"性别",prop:"sex",minWidth:90,cellRenderer:({row:e,props:t})=>s($("el-tag"),{size:t.size,type:e.sex===1?"danger":null,effect:"plain"},{default:()=>[e.sex===1?"女":"男"]})},{label:"部门",prop:"dept.name",minWidth:90},{label:"手机号码",prop:"phone",minWidth:90,formatter:({phone:e})=>fe(e,{start:3,end:6})},{label:"状态",prop:"status",minWidth:90,cellRenderer:e=>{var t;return s($("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=n.value[e.index])==null?void 0:t.loading,modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":0,"active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,style:m.value,onChange:()=>N(e)},null)}},{label:"创建时间",minWidth:90,prop:"createTime",formatter:({createTime:e})=>ge(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:180,slot:"operation"}],A=ce(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]),f=P({newPwd:""}),L=[{color:"#e74242",text:"非常弱"},{color:"#EFBD47",text:"弱"},{color:"#ffa500",text:"一般"},{color:"#1bbf1b",text:"强"},{color:"#008000",text:"非常强"}],S=l(),B=l([]);function N({row:e,index:t}){he.confirm(`确认要<strong>${e.status===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.username}</strong>用户吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{n.value[t]=Object.assign({},n.value[t],{loading:!0}),setTimeout(()=>{n.value[t]=Object.assign({},n.value[t],{loading:!1}),v("已成功修改用户状态",{type:"success"})},300)}).catch(()=>{e.status===0?e.status=1:e.status=0})}function q(e){}function J(e){v(`您删除了用户编号为${e.id}的这条数据`,{type:"success"}),u()}function K(e){}function Q(e){}function X(e){T.value=e.length,i.value.setAdaptive()}function G(){T.value=0,i.value.getTableRef().clearSelection()}function Z(){const e=i.value.getTableRef().getSelectionRows();v(`已删除用户编号为 ${ve(e,"id")} 的数据`,{type:"success"}),i.value.getTableRef().clearSelection()}function u(){return C(this,null,function*(){d.value=!0;const{data:e}=yield Oe(be(o));x.value=e.list,y.total=e.total,y.pageSize=e.pageSize,y.currentPage=e.currentPage,setTimeout(()=>{d.value=!1},500)})}const w=e=>{e&&(e.resetFields(),o.deptId="",F.value.onTreeReset(),u())};function ee({id:e,selected:t}){o.deptId=t?e:"",u()}function _(e){if(!e||!e.length)return;const t=[];for(let a=0;a<e.length;a++)e[a].disabled=e[a].status===0,_(e[a].children),t.push(e[a]);return t}function te(e="新增",t){var a,r,g,h,R,k,V,W,E;D({title:`${e}用户`,props:{formInline:{title:e,higherDeptOptions:_(z.value),parentId:(a=t==null?void 0:t.dept.id)!=null?a:0,nickname:(r=t==null?void 0:t.nickname)!=null?r:"",username:(g=t==null?void 0:t.username)!=null?g:"",password:(h=t==null?void 0:t.password)!=null?h:"",phone:(R=t==null?void 0:t.phone)!=null?R:"",email:(k=t==null?void 0:t.email)!=null?k:"",sex:(V=t==null?void 0:t.sex)!=null?V:"",status:(W=t==null?void 0:t.status)!=null?W:1,remark:(E=t==null?void 0:t.remark)!=null?E:""}},width:"46%",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>O(De,{ref:b}),beforeSure:(se,{options:re})=>{const oe=b.value.getRef(),ue=re.props.formInline;function H(){v(`您${e}了用户名称为${ue.username}的这条数据`,{type:"success"}),se(),u()}oe.validate(ie=>{ie&&H()})}})}const U=l();function ae(e){D({title:"裁剪、上传头像",width:"40%",draggable:!0,closeOnClickModal:!1,contentRenderer:()=>O(Ie,{ref:U,imgSrc:e.avatar,onCropper:t=>p.value=t}),beforeSure:t=>{t(),u()},closeCallBack:()=>U.value.hidePopover()})}de(f,({newPwd:e})=>S.value=pe(e)?-1:Fe(e).score);function ne(e){D({title:`重置 ${e.username} 用户的密码`,width:"30%",draggable:!0,closeOnClickModal:!1,contentRenderer:()=>s(ke,null,[s(xe,{ref:c,model:f},{default:()=>[s(ye,{prop:"newPwd",rules:[{required:!0,message:"请输入新密码",trigger:"blur"}]},{default:()=>[s(Se,{clearable:!0,"show-password":!0,type:"password",modelValue:f.newPwd,"onUpdate:modelValue":t=>f.newPwd=t,placeholder:"请输入新密码"},null)]})]}),s("div",{class:"mt-4 flex"},[L.map(({color:t,text:a},r)=>s("div",{class:"w-[19vw]",style:{marginLeft:r!==0?"4px":0}},[s(Re,{striped:!0,"striped-flow":!0,duration:S.value===r?6:0,percentage:S.value>=r?100:0,color:t,"stroke-width":10,"show-text":!1},null),s("p",{class:"text-center",style:{color:S.value===r?t:""}},[a])]))])]),closeCallBack:()=>f.newPwd="",beforeSure:t=>{c.value.validate(a=>{a&&(v(`已成功重置 ${e.username} 用户的密码`,{type:"success"}),t(),u())})}})}function le(e){return C(this,null,function*(){var a,r,g,h;const t=(a=(yield ze({userId:e.id})).data)!=null?a:[];D({title:`分配 ${e.username} 用户的角色`,props:{formInline:{username:(r=e==null?void 0:e.username)!=null?r:"",nickname:(g=e==null?void 0:e.nickname)!=null?g:"",roleOptions:(h=B.value)!=null?h:[],ids:t}},width:"400px",draggable:!0,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>O(Ce),beforeSure:(R,{options:k})=>{k.props.formInline,R()}})})}return me(()=>C(this,null,function*(){I.value=!0,u();const{data:e}=yield Pe();z.value=Y(e),M.value=Y(e),I.value=!1,B.value=(yield $e()).data})),{form:o,loading:d,columns:j,dataList:x,treeData:M,treeLoading:I,selectedNum:T,pagination:y,buttonClass:A,onSearch:u,resetForm:w,onbatchDel:Z,openDialog:te,onTreeSelect:ee,handleUpdate:q,handleDelete:J,handleUpload:ae,handleReset:ne,handleRole:le,handleSizeChange:K,onSelectionCancel:G,handleCurrentChange:Q,handleSelectionChange:X}}export{Ae as useUser};
